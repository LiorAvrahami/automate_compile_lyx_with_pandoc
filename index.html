<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>a python script to automate lyx compile with pandoc - on windows</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <link rel="stylesheet" href="https://gitcdn.link/repo/LiorAvrahami/automate_compile_lyx_with_pandoc/main/default_style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">a python script to automate lyx compile with pandoc - on windows</h1>
</header>
<h1 id="introduction">introduction</h1><p>the pupose of this project is to bypass the lyx convertion sequance, wich ruthlessly breaks resource file names in the latex script that is passed to pandoc.</p><p>pandoc and lyx are both really grate projects. but as I have found, they really do not mesh together.</p><p>the lyx convertion protocal is based on moving the lyx file to some temperary location, doing all the convertions there, and then moving the converted products back to the work dir. during the transfer of the files, I found lyx thwarts pandoc in three ways:</p><ol><li><p>converts all the media resources to .eps files</p></li><li><p>flattens media/resource files hierarchy - rendering reletive paths broken</p></li><li><p>adds wierd text “\string” at ends of file paths</p></li></ol><p>altho I have found that 1 could be fragilely overcome in practice by using pdflatex to convert from lyx to latex, and have found that 2 could be overcome in theory (couldn’t make this work) by running pandoc with the flag --resource-path to the origenal directory, I couldn’t find a way to deal with 3. thus I made a python script to salve my problem. this project is that python script.</p><h1 id="how-to-use">how to use</h1><p>run with flag -h and you will get:</p><pre><code>this is automate_compile_lyx_with_pandoc version 2.1
usage:
python automate_compile_lyx_with_pandoc &lt;out format&gt; &lt;root path&gt; [options]
root path: some path at which to start compiling. if a folder is specified than will run on all lyx files in folder and by default on all lyx files in subfolders.
options:
-cc or --clean-compile: clean compile. compile all. not only files that were changed.
-nr or --not_recursive: don&#39;t run on subfolders. only on given folder.
-keps or --keep_eps: don&#39;t purge .eps files. (by default this program deletes all .eps files under root.)
-gou or --go_one_up: run on the dirname of the given path. (usefull for lyx shortcuts)
-v or --view: view final file
for help run:
 python automate_compile_lyx_with_pandoc -h or --help
for clearing memory of lyx compilation times:
 python automate_compile_lyx_with_pandoc --clear-memory
example usage:
python automate_compile_lyx_with_pandoc html E:\Some_path\to_lyx_file.lyx -cc -gou</code></pre><p>in order for automate_compile_lyx_with_pandoc.py to work, “Lyx\bin” needs to be on PATH. find where you’r Lyx.exe is hiding and add that to your PATH envirment variable, this is a standurd thing to do, here are some links out of hundreds:</p><div class="center"><p><a href="https://www.google.com/search?q=add+to+PATH+windows+10">google search</a></p></div><div class="center"><p><a href="https://helpdeskgeek.com/windows-10/add-windows-path-environment-variable/">How to Add to Windows PATH Environment Variable</a></p></div><p>to find your Lyx bin folder, you can press start, type lyx, right click on lyx, “open file location”, right click on the link that opens in file explorer and again “open file location”. that should lead you there. my Lyx bin is at: C:\Program Files\LyX 2.3\bin.</p><p>in any case, you need to be able to type lyx in cmd and have Lyx open up for this project to work.</p><p class="heading" id="usage-with-.css-files">usage with .css files:</p><p>if the output file type selected is html, than if there is a .css file with the same name as the lyx file, and that is placed at the same folder as the lyx file, than that .css file will be referenced to by the output html. otherwise, if the default_style.css exists next to the automate_compile_lyx_with_pandoc.py file, it will be referanced to. if nither of these exist, an html with no style will be produced.</p><h1 id="how-to-mesh-into-lyx-gui">how to mesh into lyx gui</h1><div class="center"><p><span style="color: red"><u><span>*</span>WARNING<span>*</span></u></span>: lyx is bundled with it’s own version of python 2. this is bad for us, becouse this script was designed to run on python 3. also, lyx automatically proritises it’s own version of python over the global one. so ruinning the command python from within lyx will call it’s local python 2. the solution to this is quite easy. we only call python up via the “python3” command, so there is no room for confusion. if you are like me, and have installed python in such a way that the “python3” command is not recegnised, than you need to fix this. I fixed this by going to the python.exe file, copy pasting it, and renaming the copy to python3. not very elagent, I know, but I couldn’t think of a way this could do any harm, and was to lazy to figure out the propper way to do this.</p></div><ol><li><p>copy package to somewhere you won’t move it, and that doesnt require admin premitiions to make/edit files. I placed mine at:</p><div class="center"><p>E:\Liors_Stuff\Tools\Programs\automate_compile_lyx_with_pandoc</p></div><p><img src="step1.png" alt="image" /></p></li><li><p>go to Tools Preferances File Handaling File Formats. Click New, fill in the first 2 fields (Format,Short name) with whatever you want, (I filled them both in with auto_html) and then fill in:</p><ul><li><p>Extentions = .autocompilelyx</p></li><li><p>Copier = python3 &lt;path to automate_compile_lyx_with_pandoc.py&gt; &lt;type your output format here. I wrote “html”&gt; $$o -gou</p><p>so in my case it’s Copier = python3 E:\Liors_Stuff\Tools\Programs\automate_compile_lyx_with_pandoc\automate_compile_lyx_with_pandoc.py html $$o -gou</p></li><li><p>click apply</p></li></ul><p><img src="step2.png" alt="image" /></p></li><li><p>go to Tools Preferances File Handaling Converters. select:</p><ul><li><p>From format: select “Lyx”</p></li><li><p>To format: select the name you gave the file format you made (in my case its auto_html).</p><p>(in my case it’s autohtml)</p></li><li><p>Converter: python3 &lt;path to make_dummy_file.py&gt; $$o</p><p>(in my case it’s python3 E:\Liors_Stuff\Tools\Programs\automate_compile_lyx_with_pandoc\make_dummy_file.py $$o)</p></li><li><p>Click Add, click apply</p></li></ul><p><img src="step3.png" alt="image" /></p></li><li><p>(Optional) - to make a keyboard shortcut:</p><ul><li><p>Tools Preferances Editing Shortcuts New</p></li><li><p>Function = buffer-export &lt;name of format you chose&gt;</p><p>(in my case Function = buffer-export auto_html)</p></li><li><p>select key binding</p></li><li><p>click ok, click apply</p></li></ul><p><img src="step4.png" alt="image" /></p></li><li><p>(Optional) - you can add more key shortcuts that do other things, like fource compile, preview resault, etc. this is done by adding new file formats with slightly differant names, that do the same thing but with othet flags. for example -cc fources compilation of file, even if it is detected that the lyx file was not changed. for full list of flags run automate_compile_lyx_with_pandoc.py with -h flag:</p><div class="center"><p>python automate_compile_lyx_with_pandoc.py -h</p></div><p>for each file format redo steps 2 and 3 also, so in my case I have:</p><ul><li><p>auto_html_fourced:</p><div class="center"><pre><code>python3 &quot;E:\Liors_Stuff\Tools\Programs\automate_compile_lyx_with_pandoc\automate_compile_lyx_with_pandoc.py&quot; html $$o -gou -cc</code></pre></div></li><li><p>auto_html_view:</p><div class="center"><pre><code>python3 &quot;E:\Liors_Stuff\Tools\Programs\automate_compile_lyx_with_pandoc\automate_compile_lyx_with_pandoc.py&quot; html $$o -gou -v</code></pre></div></li></ul></li></ol><p><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p><section class="footnotes" role="doc-endnotes"><hr /><ol><li id="fn1" role="doc-endnote"><p>this file was made with automate_compile_lyx_with_pandoc version 2.1<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>
</body>
</html>
